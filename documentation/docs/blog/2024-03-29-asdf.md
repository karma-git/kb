---
title: "Управляйте версиями всего с asdf: попрощайтесь с адским переключением"
tags:
  - terraform
comments: true
---

**Дисклеймер:**

> У Автора несколько дней опыта asdf. Часть статьи сгенерирована LLM. Возможны неточности. Перепроверяйте информацию в документации.

## TL;DR:

asdf — это мощный и гибкий инструмент для управления версиями. Он предлагает гораздо больше, чем простое переключение, обеспечивая консистентность, удобство и расширяемость. Но, как и любой инструмент, требует времени на освоение.

<https://asdf-vm.com/>

<https://github.com/asdf-vm/asdf>

## Введение

В мире DevOps и разработки программного обеспечения, где проекты могут охватывать разные технологии и стеки, часто возникает одна и та же головная боль: управление версиями. Представьте ситуацию: один проект требует Python 3.8, другой — Python 3.10, а параллельно вам нужно поддерживать старый проект на Python 2.7 (да, такое бывает!). И это только Python! Добавьте к этому необходимость жонглировать версиями Node.js, Ruby, Java, утилит командной строки вроде Terraform или AWS CLI... Настоящий хаос, не правда ли?

Традиционно, мы решаем эту проблему с помощью специализированных инструментов, разработанных для каждого языка или технологии. Для Python это может быть pyenv, для Node.js — nvm, а для Terraform — tfenv. Эти инструменты, безусловно, полезны, и каждый из них отлично справляется со своей задачей.

Однако, такой подход порождает новые сложности:

Разные инструменты, разные правила: Каждый менеджер версий имеет свои собственные команды, конфигурации и способы работы. Нужно запоминать их все, что увеличивает когнитивную нагрузку.
Конфликты и несовместимости: Иногда разные менеджеры версий могут конфликтовать друг с другом или портить глобальную конфигурацию системы.
Сложность настройки CI/CD: Автоматизация сборки и развертывания проектов с разными требованиями к версиям превращается в настоящий кошмар.
К счастью, существует более элегантное и универсальное решение: asdf. Этот инструмент объединяет в себе функциональность специализированных менеджеров версий, предоставляя единый интерфейс и концепцию для управления практически любым инструментом разработки. С asdf вы сможете забыть про необходимость устанавливать и настраивать кучу разных утилит, упростите свой workflow и повысите продуктивность.

Давайте же рассмотрим, как asdf работает и почему он заслуживает вашего внимания!

## Пример

Отлично, вот базовый пример квикстарта для установки и использования Terraform с `asdf`, при этом сохраняя уже установленную версию.

**1. Установка asdf (пропустим, зависит от вашей системы)**

Предположим, asdf уже установлен.

**2. Добавление плагина Terraform:**

```bash
asdf plugin add terraform
```

**3. Просмотр доступных версий Terraform:**

```bash
asdf list all terraform
```

Это выведет список всех доступных версий Terraform, которые можно установить с помощью плагина asdf.

**4. Установка последней версии Terraform:**

```bash
asdf install terraform latest
```

asdf установит последнюю доступную версию Terraform.

**5. Установка конкретной версии (например, той, что у вас уже есть):**

Предположим, у вас уже установлена версия `1.11.3`.

```bash
asdf install terraform 1.11.3
```

Это гарантирует, что asdf будет управлять этой версией, даже если она уже установлена в системе.

**6. Установка глобальной версии Terraform (по умолчанию):**

```bash
asdf global terraform latest
```

Это установит последнюю версию Terraform как глобальную версию по умолчанию. Теперь, когда вы запустите `terraform -v` в любом месте, будет использоваться эта версия.

**7. Использование конкретной версии в проекте:**

Предположим, ваш текущий проект требует версию `1.11.3`. Перейдите в корень проекта и создайте файл `.tool-versions` (если его нет) или добавьте в него строку:

```
terraform 1.11.3
```

Затем в этой директории выполните:

```bash
asdf local terraform 1.11.3
```

Теперь, когда вы находитесь в директории вашего проекта, `terraform -v` будет выводить `1.11.3`. Когда вы находитесь в любой другой директории, будет использоваться глобальная версия (последняя).

**Пример структуры проекта:**

```
my_project/
  .tool-versions  # Содержит "terraform 1.11.3"
  main.tf
```

**Важно:**

* asdf не удаляет версии, установленные вне его. Он просто управляет тем, какая версия используется в данный момент.
* Если у вас есть переменная окружения `PATH`, указывающая на установку Terraform вне asdf, вам может потребоваться изменить ее, чтобы приоритет был у shims asdf.
* Не забудьте "reshim" asdf после установки новых версий:

    ```bash
    asdf reshim terraform
    ```

    Это гарантирует, что asdf правильно создаст ссылки на исполняемые файлы.

Этот пример позволяет вам установить последнюю версию Terraform для новых проектов или глобального использования, но при этом использовать конкретную версию (например, ту, что уже установлена) в существующих проектах.



## Больше

Квикстарт в asdf — это только верхушка айсберга! asdf обладает множеством мощных функций, которые делают его действительно удобным инструментом. Давай разберем некоторые ключевые особенности, которые выходят за рамки базовой установки и переключения версий:

**1.  `.tool-versions` для консистентности проекта:**

    * `asdf local` и `asdf global` позволяют не только установить версии, но и сохранить их в файле `.tool-versions`.
    * Этот файл помещается в корень проекта и гарантирует, что каждый разработчик (и CI/CD) использует именно те версии инструментов, которые указаны в файле.
    * Это исключает ситуации, когда "на моей машине работает", потому что версии не совпадают.
    * Пример файла `.tool-versions`:

        ```
        python 3.9.18
        nodejs 18.17.1
        terraform 1.5.7
        ```

**2.  Переменные окружения:**

    * asdf автоматически устанавливает переменные окружения, необходимые для работы с разными версиями инструментов (например, `PATH`).
    * Это избавляет от необходимости вручную настраивать переменные и избегать конфликтов.

**3.  Поддержка плагинов:**

    * asdf расширяется с помощью плагинов. Каждый плагин отвечает за управление конкретным инструментом (Python, Go, и т. д.).
    * Плагины можно легко добавлять, удалять и обновлять, что делает asdf очень гибким.
    * Многие плагины активно поддерживаются сообществом.

**4.  Расширяемость:**

    * Если для вашего любимого инструмента нет плагина, вы можете написать свой собственный.
    * Это позволяет asdf адаптироваться к любым потребностям разработки.

**5.  Интерактивность:**

    * asdf предоставляет удобные команды для установки, переключения, просмотра версий.
    * Например, `asdf list all python` покажет все доступные для установки версии Python.

**6.  Установка из исходников:**

    * asdf позволяет устанавливать версии инструментов не только из готовых бинарников, но и из исходников (если это необходимо).

**7.  Автоматическая установка зависимостей:**

    * Некоторые плагины asdf умеют автоматически устанавливать необходимые зависимости для работы инструмента.

**Но, конечно, есть и свои нюансы:**

* **Настройка:** Поначалу нужно потратить время на установку asdf и плагинов.
* **Совместимость плагинов:** Иногда плагины могут конфликтовать друг с другом или требовать определённых версий asdf.
* **Кривая обучения:** Хотя asdf довольно прост в использовании, нужно привыкнуть к его концепциям и командам.

**TL;DR:** asdf — это мощный и гибкий инструмент для управления версиями. Он предлагает гораздо больше, чем простое переключение, обеспечивая консистентность, удобство и расширяемость. Но, как и любой инструмент, требует времени на освоение.
